# ğŸŒŸ AI å¤šæ¨¡æ€è¯­éŸ³åŠ©æ‰‹ç³»ç»Ÿ (GPT-SoVITS + DeepSeek + ToolAgent)

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªé›†æˆäº†è¯­éŸ³è¯†åˆ« (ASR)ï¼Œå¤§è¯­è¨€æ¨¡å‹ç”Ÿæˆ (LLM)ï¼Œè¯­éŸ³åˆæˆ (TTS)ï¼Œå¤šäººç‰©è§’è‰²ç®¡ç†å’Œè®°å¿†/ä»»åŠ¡ç®¡ç†äºŒç»´ AI åŠ©æ‰‹ç³»ç»Ÿï¼Œæ”¯æŒç”¨æˆ·åˆ†ç¦»ã€è®°å¿†ç»„ç»‡ã€ä»»åŠ¡æé†’ã€å®šæ—¶ TTS æ“ä½œç­‰åŠŸèƒ½ã€‚

---

## ğŸš€ é¡¹ç›®å¯åŠ¨

```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨ Flask åç«¯ (5001 ç«¯å£)
3090 gpu: 117.50.190.72     python app.py      40ç³»gpu: 106.75.127.211    ./start.sh
```

---

## ğŸ”§ æ ¸å¿ƒæµç¨‹è¯´æ˜

### ç”¨æˆ·éœ€æ±‚ï¼ˆè¾“å…¥è¯­éŸ³/æ–‡æœ¬ï¼‰

* `/api/dispatch` æ¥æ”¶ç”¨æˆ·è¯·æ±‚ï¼Œåˆ¤æ–­æ˜¯ **è¯­éŸ³è¾“å…¥** è¿˜æ˜¯ **æ–‡æœ¬è¾“å…¥**
* å¦‚æœæ˜¯è¯­éŸ³ï¼šä¿å­˜æ–‡ä»¶ï¼Œä¼ å…¥ `/api/asr`ï¼Œè°ƒç”¨ Faster-Whisper è½¬æˆæ–‡æœ¬

### è°ƒåº¦å™¨å¤„ç†

* é€šè¿‡ MCP åè®®æ‰“åŒ…ä¸ºè§„èŒƒåŒ–æ¶ˆæ¯
* è°ƒç”¨ `PlannerAgent` è§£ææ„å›¾ï¼Œæ ¹æ® DeepSeek ç”Ÿæˆå¤š Agent è°ƒç”¨è®¡åˆ’ï¼š

  * MemoryAgent: æ“ä½œè®°å¿†/ä»»åŠ¡
  * ToolAgent: åˆ‡æ¢è§’è‰²/æ“ä½œæœ¬åœ°åº”ç”¨
  * SearchAgent: è”ç½‘æœç´¢
* åç»­ç»™ ChatAgent è¿›è¡Œæœ€ç»ˆå±•ç¤º

### å›å¤ç”Ÿæˆ + è¯­éŸ³åˆæˆ

* ChatAgent é‡‡ç”¨ `qwen-plus` ç”Ÿæˆæ–‡æœ¬å›å¤
* åç»­ä¼ å…¥ `/api/tts`ï¼Œè°ƒç”¨ GPT-SoVITS API è¿›è¡Œåˆæˆ
* åŒæ—¶è¿›è¡Œç®€å•æƒ…ç»ªåˆ†æï¼Œè¿”å› Base64 éŸ³é¢‘ + è§’è‰²ä¿¡æ¯

### éœ€è¦æ—¶é—´è§¦å‘

* æ‰€æœ‰ `add_todo`ä»»åŠ¡ï¼Œåˆ›å»ºåè‡ªåŠ¨è¢« `scheduler.py` æ‰«æå’Œå®šæ—¶ trigger
* åˆ°ç‚¹åè°ƒç”¨ `/api/tts` + `say` æ“ä½œæ’­æ”¾å£°éŸ³

---

## ğŸ¤– Agent ä½“ç³»

| Agent          | ä½œç”¨                                       |
| -------------- | ---------------------------------------- |
| `PlannerAgent` | è¯†åˆ«ç”¨æˆ· intentï¼Œç”Ÿæˆè§„èŒƒåŒ–è°ƒåº¦åˆ—è¡¨                    |
| `MemoryAgent`  | æ“ä½œ memory / personality / todo æ•°æ®ï¼Œè¿›è¡Œç»¼åˆç»´æŠ¤ |
| `ToolAgent`    | è°ƒç”¨ toolbox.py æœ¬åœ°åŠŸèƒ½ï¼Œå¦‚æ’­æ”¾éŸ³ä¹ï¼Œåˆ‡æ¢è§’è‰²            |
| `SearchAgent`  | è”ç½‘æœç´¢ (æ—¥æœŸ/å¤©æ°”)                             |
| `ChatAgent`    | ä½“ç¯ï¼Œæ„é€ æ–‡æœ¬å›å¤ï¼Œè¿›è¡Œ TTS                         |

---

##  æ‰§è¡Œæµç¨‹ä¸æ¨¡å—å¯¹ç…§å›¾

```
ğŸ™ ç”¨æˆ·è¾“å…¥ï¼ˆæ–‡æœ¬æˆ–è¯­éŸ³ï¼‰
â”‚
â”œâ”€â”€> ğŸŒ /api/dispatchï¼ˆapp.pyï¼‰
â”‚     â”œâ”€ å¦‚æœæ˜¯è¯­éŸ³ â†’ ğŸ”Š /api/asrï¼ˆasr_server.pyï¼‰ â†’ è¿”å›æ–‡æœ¬
â”‚     â””â”€ æ„å»ºæ ‡å‡†æ¶ˆæ¯ â†’ ğŸ“¦ build_messageï¼ˆmcp_message.pyï¼‰
â”‚
â”œâ”€â”€> ğŸ§  PlannerAgent.handleï¼ˆPlannerAgent.pyï¼‰
â”‚     â”œâ”€ è°ƒç”¨ DeepSeek â†’ core/llm/deepseek_api.py
â”‚     â””â”€ è§£ææŒ‡ä»¤ä¸ºä»»åŠ¡è°ƒç”¨é“¾
â”‚
â”œâ”€â”€> å¤šä¸ª Agent è¢«è°ƒç”¨ï¼ˆæ ¹æ® planner è¾“å‡ºï¼‰
â”‚     â”œâ”€ ğŸ—‚ MemoryAgent.handle â†’ æ“ä½œæ•°æ®åº“ï¼ˆmodel.py + services.pyï¼‰
â”‚     â”œâ”€ ğŸ›  ToolAgent.handle â†’ æ“ä½œ toolbox.pyï¼ˆæ’­æ”¾éŸ³ä¹ã€æ’­æŠ¥ã€è§’è‰²åˆ‡æ¢ï¼‰
â”‚     â”œâ”€ ğŸŒ SearchAgent.handle â†’ æ‰§è¡Œè”ç½‘æŸ¥è¯¢ï¼ˆå¦‚å¤©æ°”ï¼‰
â”‚     â””â”€ ğŸ’¬ ChatAgent.handle â†’ è°ƒç”¨ qwen_api.py ç”Ÿæˆæ–‡æœ¬
â”‚
â”œâ”€â”€> åˆæˆè¯­éŸ³ï¼š
â”‚     â””â”€ ğŸ—£ generate_audio.pyï¼ˆè°ƒç”¨ GPT-SoVITS æœ¬åœ°æ¨ç†æœåŠ¡ï¼‰
â”‚
â””â”€â”€> ğŸ“¤ è¿”å›ç»“æœï¼š
      JSON æ ¼å¼ = {"character": "...", "text": "...", "audio": Base64éŸ³é¢‘}
```

---

## ğŸ“„ æ•°æ®åº“è¡¨è®¾è®¡

### `users`

* user\_id (PK)
* created\_at

### `memory`

* id, user\_id (FK), role, type, content, created\_at

### `personality`

* (user\_id, type, tag) ä¸ºè”åˆ PK
* content

### `todos`

* id, user\_id, owner\_type, title, due\_time, status, description

---

## ğŸ“Š çŸ­æœŸè®°å¿†ç³»ç»Ÿ

* ä¿å­˜æœ€è¿‘ 50 æ¡è®°å½• (role + text)
* åœ¨ ChatAgent / MemoryAgent / ToolAgent ä¸­ä½¿ç”¨
* å¯é€šè¿‡ `clear_short_term(user_id)` æ¸…ç©º

---

## ğŸ§ è¯­éŸ³åŠŸèƒ½æ¨¡å—

### ASR

* åŸºäº Faster-Whisper
* 16kHz å•å£°é“æ ‡å‡†åŒ–ï¼Œè‡ªåŠ¨è½¬ç®€ä½“

### TTS

* åŸºäº GPT-SoVITS API
* æ”¯æŒè§’è‰²é¢„è®¾ã€promptæ–‡æœ¬ã€æƒ…ç»ªæ§åˆ¶

---

## ğŸ“ ä»£ç ä½ç½®å¿«é€Ÿç´¢å¼•ï¼ˆè·¯å¾„å®šä½ï¼‰

| åŠŸèƒ½                | æ–‡ä»¶è·¯å¾„                                 |
| ----------------- | ------------------------------------ |
| Flask å¯åŠ¨          | `app.py`                             |
| MCP æ„å»ºæ ¼å¼          | `core/message/mcp_message.py`        |
| ASR æ¨¡å—            | `core/audio/asr_server.py`           |
| TTS åˆæˆ            | `core/audio/generate_audio.py`       |
| Prompt æ„å»º         | `core/llm/prompt_builder.py`         |
| Prompt å®ç°çŠ¶æ€       | `core/llm/prompt_state.py`           |
| LLM APIï¼ˆDeepSeekï¼‰ | `core/llm/deepseek_api.py`           |
| LLM APIï¼ˆé€šä¹‰ï¼‰       | `core/llm/qwen_api.py`               |
| çŸ­æœŸè®°å¿†ç¼“å­˜            | `core/short_memory/memory_buffer.py` |
| æ•°æ®æ¨¡å‹å®šä¹‰            | `database/model.py`                  |
| æ•°æ®æœåŠ¡æ“ä½œ            | `database/services.py`               |
| å®šæ—¶å™¨è°ƒåº¦             | `database/scheduler.py`              |
| å·¥å…·å‡½æ•°é›†åˆ            | `utils/toolbox.py`                   |
| å„ Agent å®ç°        | `agents/` ç›®å½•ä¸‹æ‰€æœ‰æ¨¡å—                    |

---

## è®¡åˆ’ï¼š
## ğŸ›£ é¡¹ç›®è·¯çº¿å›¾ï¼ˆRoadmapï¼‰

æœ¬é¡¹ç›®çš„å¼€å‘è®¡åˆ’ä¸é˜¶æ®µè¯·æŸ¥çœ‹ ğŸ‘‰ [MomoOS Roadmap çœ‹æ¿](https://github.com/users/XguihuaX/projects/1)


## å¤‡æ³¨ï¼š
ç›®å‰app.pyä¸‹ alarm å’Œæ•´ä½“é—¹é’Ÿä¸è®¡åˆ’æ²¡æœ‰æ›´æ–°åˆ°æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œqq_botåœ¨è¿›è¡Œä¸­


## ç»“è¨€

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªæˆç†Ÿçš„å¤š Agent + å¤šæ¨¡æ€åˆä½œè®¾è®¡ï¼Œé€‚åˆä½œä¸ºæœ¬åœ° AI è¯­éŸ³/å®šæ—¶/åŠ©ç†å‹åº”ç”¨çš„åŸºç¡€åº“ï¼Œå…¶æ„æˆæ€§ã€åˆ†å±‚æ€§å’ŒæŠ½è±¡çº§åˆ«æ˜ç¡®ã€‚

ğŸš€ å¯å±•æœ›æ–¹å‘ï¼šåŠ¨ä½œåº“æ‰©å±•ã€Unity å£å‹åŠ¨ä½œç®¡ç†ã€äººç‰©æ— ç¼è½¯åˆ‡æ¢ã€å®šåˆ¶åŒ–èµ„æ–™è®°å¿†åº“ã€n8n è‡ªåŠ¨åŒ–æ­é…ã€‚
